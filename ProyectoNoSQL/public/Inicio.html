<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook</title>
</head>

<body>
    <header class="header" style="background-color: #ececec;">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://kit.fontawesome.com/0a39c8afa7.js" crossorigin="anonymous"></script>
        <!--<script src="/scripts/publicaciones.js" type="application/javascript"></script>  -->
        <link href="css/estilo.css" rel="stylesheet">


        <!-----------------------------  NAV PLANTILLA  ----------------------------->
        <nav class="navbar navbar-expand-sm" style="background-color: #ececec;">
            <div class="container">
                <a class="navbar-brand" href="Inicio.html" id="estiloFuenteTx1"><i class="fab fa-facebook"
                        id="estiloIconoFacebook"></i> Facebook</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="#">Comercios</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Mensajes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Cerrar session</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-----------------------------  CONTENIDO PLANTILLA  ----------------------------->

    <main>
        <section class="main-content">
            <div class="sidebar">
                <h2><b>Lista de Amigos</b></h2>
                <ul class="contacts-list">
                    <li>
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Dennis Han">
                        <p>Dennis Han</p>
                    </li>
                    <li>
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Eric Jones">
                        <p>Eric Jones</p>
                    </li>
                    <li>
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Cynthia Lopez">
                        <p>Cynthia Lopez</p>
                    </li>
                    <li>
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Anna Becklund">
                        <p>Anna Becklund</p>
                    </li>
                    <li>
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Aiden Brown">
                        <p>Aiden Brown</p>
                    </li>
                    <li>
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Betty Chen">
                        <p>Betty Chen</p>
                    </li>
                    <li>
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Dan Brown">
                        <p>Dan Brown</p>
                    </li>
                    <li>
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Henri Cook">
                        <p>Henri Cook</p>
                    </li>
                </ul>
            </div>
            <div class="main-content-area">
                <div class="Bienvenida">
                    <h2><b>¡Bienvenido de vuelta, <span id="nombreUsuario"></span>!</b></h2>
                </div>
                <div class="post-section">
                    <div class="create-post">
                        <img src="https://i.pinimg.com/280x280_RS/42/03/a5/4203a57a78f6f1b1cc8ce5750f614656.jpg"
                            alt="Avatar">
                        <div class="post_">
                            <a href="postear.html">Realizar un post</a>
                        </div>
                        
                    </div>
                </div>

                <div class="suggested-section" id="publicaciones-section">
                </div>
                
            </div>
            <div class="contacts-section">
                <ul class="sidebar-menu">
                    <h2><b>Anuncios</b></h2>
                    <li><a href="#"></a></li>
                </ul>
            </div>
        </section>
    </main>

    <!-----------------------------  FOOTER PLANTILLA  ----------------------------->

    <footer class="footerPlantilla" id="footerPlantilla">
        <div class="container">
            <div class="row">
                <div class="col">
                    <p class="lead text-center">
                        &copy; Facebook Inc. Todos los derechos reservados
                    </p>
                </div>
            </div>
        </div>
    </footer>

</body>
<script>
    // Función para formatear la fecha en (dd/mm/yyyy)
    function formatDate(date) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0'); // Sumamos 1 ya que los meses son indexados desde 0
        const year = date.getFullYear();

        return `${day}/${month}/${year}`;
    }

    // Continuación del script JavaScript existente
document.addEventListener('DOMContentLoaded', async function () {
    const publicacionesSection = document.getElementById('publicaciones-section');

    // Función para renderizar los comentarios de una publicación
    function renderizarComentarios(comentarios) {
        const comentariosList = document.createElement('ul');
        comentariosList.classList.add('comentarios-list');
        
        comentarios.forEach(comentario => {
            const comentarioItem = document.createElement('li');
            comentarioItem.classList.add('comentario-item');
            comentarioItem.innerHTML = `
                <p><strong>${comentario.autor}</strong>: ${comentario.mensaje}</p>
            `;
            comentariosList.appendChild(comentarioItem);
        });

        return comentariosList;
    }

    // Realizar solicitud al servidor para obtener las publicaciones
    try {
        const response = await fetch('/api/publicaciones');
        const data = await response.json();

        // Verificar si la respuesta contiene datos de las publicaciones
        if (data && data.publicaciones && data.publicaciones.length > 0) {
            data.publicaciones.forEach(publicacion => {
                const postItem = document.createElement('div');
                postItem.classList.add('post-item');

                // Formatear la fecha
                const formattedDate = formatDate(new Date(publicacion.Fecha));

                // Crear el contenido de la publicación
                const postHeader = document.createElement('div');
                postHeader.classList.add('post-header');
                postHeader.innerHTML = `
                    <img src="${publicacion.Multimedia}" alt="${publicacion.Nombre_usuario}">
                    <h4>${publicacion.Nombre_usuario}</h4>
                    <p>${formattedDate}</p>
                `;
                const postContent = document.createElement('div');
                postContent.classList.add('post-content');
                postContent.innerHTML = `
                    <p>${publicacion.desc}</p>
                    <img src="${publicacion.Multimedia}" alt="Post Image">
                `;
                
                // Renderizar los comentarios de la publicación
                const comentariosRenderizados = renderizarComentarios(publicacion.comentarios);
                postContent.appendChild(comentariosRenderizados);

                // Agregar el contenido de la publicación al elemento principal
                postItem.appendChild(postHeader);
                postItem.appendChild(postContent);

                // Agregar la publicación al área designada en el HTML
                publicacionesSection.appendChild(postItem);

                // Separador entre publicaciones
                const separator = document.createElement('hr');
                publicacionesSection.appendChild(separator);
            });
        } else {
            // Si no hay publicaciones, mostrar un mensaje de que no hay publicaciones disponibles
            publicacionesSection.innerHTML = '<p>No hay publicaciones disponiblesSS.</p>';
        }
    } catch (error) {
        console.error('Error al obtener las publicaciones:', error);
        publicacionesSection.innerHTML = '<p>Ocurrió un error al obtener las publicaciones.</p>';
    }
});

</script>


</html>